<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Managing Python GluonTS Environments • modeltime.gluonts</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Managing Python GluonTS Environments">
<meta property="og:description" content="modeltime.gluonts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltime.gluonts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Start Here</li>
    <li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/managing-envs.html">Managing GluonTS Environments</a>
    </li>
    <li>
      <a href="../articles/using-gpus.html">Using GPUs with GluonTS</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    API
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">API Functions</li>
    <li>
      <a href="../reference/index.html">
        <span class="fa fa-home"></span>
         
        Function Reference
      </a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Change History</li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecosystem
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Forecast</li>
    <li>
      <a href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Improve</li>
    <li>
      <a href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Scale</li>
    <li>
      <a href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/modeltime.gluonts">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="managing-envs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Managing Python GluonTS Environments</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime.gluonts/blob/master/vignettes/managing-envs.Rmd"><code>vignettes/managing-envs.Rmd</code></a></small>
      <div class="hidden name"><code>managing-envs.Rmd</code></div>

    </div>

    
    
<p>This section covers how to create, modify, and customize Python GluonTS Environments.</p>
<div id="package-requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#package-requirements" class="anchor"></a>Package Requirements</h2>
<p>The <code>modeltime.gluonts</code> has the following minimum requirements:</p>
<ul>
<li>A recent version of Python (Recommend &gt;= 3.6)</li>
<li>A Python environment containing the “GluonTS Stack”:
<ul>
<li><code>gluonts</code></li>
<li><code>mxnet</code></li>
<li><code>pandas</code></li>
<li><code>numpy</code></li>
<li><code>pathlib</code></li>
</ul>
</li>
</ul>
<p>That’s it. If you have these inside a Conda or Virtual Environment, then you can use <code>modeltime.gluonts</code>.</p>
</div>
<div id="connecting-your-python-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#connecting-your-python-environment" class="anchor"></a>Connecting Your Python Environment</h2>
<p>There are 2 main ways to connect an python environment to <code>modeltime.gluonts</code>:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Default GluonTS Environment Setup</strong>: Most proven. Modeltime GluonTS creates an ‘r-gluonts’ environment with python package versions that were tested.</p></li>
<li><p><strong>Custom GluonTS Environment Setup</strong>: Most flexible. You create the environment, you ensure that dependency requirements are met, and you define how to connect to it.</p></li>
</ol>
</div>
<div id="method-1-default-gluonts-environment-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#method-1-default-gluonts-environment-setup" class="anchor"></a>Method 1: Default GluonTS Environment Setup</h2>
<p>This process uses the <strong>Conda Package Manager</strong> to set up a new conda environment called “r-gluonts”. It’s quick and easy, and most importantly the package versions that are selected all work together (I test them when developing).</p>
<div id="make-sure-you-have-conda" class="section level3">
<h3 class="hasAnchor">
<a href="#make-sure-you-have-conda" class="anchor"></a>1. Make sure you have conda</h3>
<p>Get the conda version. If you don’t have conda, then install with <code><a href="https://rdrr.io/pkg/reticulate/man/install_miniconda.html">reticulate::install_miniconda()</a></code> or <code><a href="https://rdrr.io/pkg/reticulate/man/conda-tools.html">reticulate::conda_install()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/conda-tools.html">conda_version</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="run-install_gluonts-set-up-the-default-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#run-install_gluonts-set-up-the-default-environment" class="anchor"></a>2. Run install_gluonts() (set up the Default Environment):</h3>
<p>This downloads the “GluonTS Stack” that the <code>modeltime.gluonts</code> package is tested using and places it into a Conda environment named “r-gluonts”. When you run <code><a href="https://github.com/business-science/modeltime.gluonts">library("modeltime.gluonts")</a></code>, it attempts to use the “r-gluonts” environment.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">modeltime.gluonts</span><span class="fu">::</span><span class="fu"><a href="../reference/install_gluonts.html">install_gluonts</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="optional-modifying-the-default-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#optional-modifying-the-default-environment" class="anchor"></a>3. [Optional] Modifying the Default Environment:</h3>
<p>You can modify this environment, adding more python libraries as needed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/py_install.html">py_install</a></span><span class="op">(</span>
    envname  <span class="op">=</span> <span class="st">"r-gluonts"</span>,
    packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"sklearn"</span>
    <span class="op">)</span>,
    method <span class="op">=</span> <span class="st">"conda"</span>,
    pip <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="activate-the-default-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#activate-the-default-environment" class="anchor"></a>4. Activate the Default Environment:</h3>
<p>Each time you load <code><a href="https://github.com/business-science/modeltime.gluonts">library(modeltime.gluonts)</a></code>, the package will bind to the “r-gluonts” python environment by default. If found, it will automatically bind to this environment.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime.gluonts">modeltime.gluonts</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="check-the-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#check-the-environment" class="anchor"></a>5. Check the Environment</h3>
<p>Make sure that the environment has been changed to the default ‘r-gluonts’ environment. We can see that <code>r-gluonts</code> environment is being used in the python path.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/py_discover_config.html">py_discover_config</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="discover_config_rgluonts.jpg" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="method-2-custom-gluonts-python-environments" class="section level2">
<h2 class="hasAnchor">
<a href="#method-2-custom-gluonts-python-environments" class="anchor"></a>Method 2: Custom GluonTS Python Environments</h2>
<p>It’s quite possible you may have a Virtual Environment or different Conda Environment that you would prefer to use. This is possible by setting a <strong>System Environment Variable named ‘GLUONTS_PYTHON’</strong> before running <code><a href="https://github.com/business-science/modeltime.gluonts">library(modeltime.gluonts)</a></code>.</p>
<div id="gotcha-1-restart-r-session" class="section level3">
<h3 class="hasAnchor">
<a href="#gotcha-1-restart-r-session" class="anchor"></a>1. [GOTCHA #1] Restart R Session</h3>
<p>You will need to restart R session if you’ve already used a <code>reticulate</code> environment or run <code><a href="https://github.com/business-science/modeltime.gluonts">library(modeltime.gluonts)</a></code>. Restarting the R Session is the only current way to disconnect from an active Python Environment.</p>
<p>Make sure that the environment has been changed to the default reticulate environment. We can see that <code>r-reticulate</code> environment is being used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/py_discover_config.html">py_discover_config</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="discover_config_reticulate.jpg" width="90%" style="display: block; margin: auto;"></p>
</div>
<div id="create-a-custom-python-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-custom-python-environment" class="anchor"></a>2. Create a Custom Python Environment</h3>
<p>You can create an environment containing the python packages needed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/py_install.html">py_install</a></span><span class="op">(</span>
    envname  <span class="op">=</span> <span class="st">"my_gluonts_env"</span>,
    python_version <span class="op">=</span> <span class="st">"3.6"</span>,
    packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
        <span class="st">"mxnet==1.6.0"</span>,
        <span class="st">"gluonts==0.6.3"</span>,
        <span class="st">"pandas"</span>,
        <span class="st">"numpy"</span>,
        <span class="st">"pathlib"</span>
    <span class="op">)</span>,
    method <span class="op">=</span> <span class="st">"conda"</span>,
    pip <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="locate-the-python-path" class="section level3">
<h3 class="hasAnchor">
<a href="#locate-the-python-path" class="anchor"></a>3. Locate the Python Path</h3>
<p>This locates the path to the python executable for the ‘my_gluonts_env’ environment that we just created.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">my_gluonts_env_python_path</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/conda-tools.html">conda_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"my_gluonts_env"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">python</span><span class="op">)</span>

<span class="va">my_gluonts_env_python_path</span>
<span class="co">#&gt; "/Users/mdancho/Library/r-miniconda/envs/my_gluonts_env/bin/python"</span></code></pre></div>
</div>
<div id="set-the-system-environment-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#set-the-system-environment-variable" class="anchor"></a>4. Set the System Environment Variable</h3>
<p>Set the system environment variable named ‘GLUONTS_PYTHON’ with the path to the python executable. Once this is set, loading <code><a href="https://github.com/business-science/modeltime.gluonts">library(modeltime.gluonts)</a></code> will use this path to activate the environment.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>GLUONTS_PYTHON <span class="op">=</span> <span class="va">my_gluonts_env_python_path</span><span class="op">)</span></code></pre></div>
<p>Verify it’s been set.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"GLUONTS_PYTHON"</span><span class="op">)</span>
<span class="co">#&gt; "/Users/mdancho/Library/r-miniconda/envs/my_gluonts_env/bin/python"</span></code></pre></div>
</div>
<div id="load-modeltime-gluonts" class="section level3">
<h3 class="hasAnchor">
<a href="#load-modeltime-gluonts" class="anchor"></a>5. Load Modeltime GluonTS</h3>
<p>Running <code><a href="https://github.com/business-science/modeltime.gluonts">library(modeltime.gluonts)</a></code> now binds to the custom environment.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime.gluonts">modeltime.gluonts</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="gotcha-2-check-your-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#gotcha-2-check-your-environment" class="anchor"></a>6. [Gotcha #2] Check Your Environment</h3>
<p>Make sure that the environment has been changed to the default reticulate environment. We can see that environment is being used. If setting your python environment was done properly, you should see <code>my_gluonts_env</code> in the Python Path.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/py_discover_config.html">py_discover_config</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="discover_config_custom.jpg" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
